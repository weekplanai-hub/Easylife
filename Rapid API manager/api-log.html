<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API-logg | Weekplan.ai</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display:wght@400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/styles/auth-modal.css" />
  <style>
    :root {
      --bg: #f3efe4;
      --body-bg: radial-gradient(circle at top, rgba(255, 255, 252, 0.95) 0%, var(--bg) 55%, #efe6d7 100%);
      --panel: #fffdf7;
      --panel-soft: rgba(255, 253, 247, 0.9);
      --text: #2f2a26;
      --muted: #6d665c;
      --accent: #3f7a5c;
      --accent-dark: #305b45;
      --border: #e1d8c8;
      --shadow: 0 18px 42px rgba(56, 50, 45, 0.12);
      --shadow-soft: 0 12px 30px rgba(56, 50, 45, 0.08);
      --header-bg: rgba(255, 252, 246, 0.92);
      --nav-link: #6d665c;
      --nav-link-hover-bg: rgba(63, 122, 92, 0.12);
      --nav-link-active-bg: rgba(63, 122, 92, 0.18);
      --badge-bg: rgba(240, 232, 216, 0.85);
      --badge-error-bg: rgba(233, 154, 143, 0.35);
      --badge-text: #305b45;
      --badge-error-text: #b5433b;
      --code-bg: rgba(63, 122, 92, 0.12);
      --code-text: #2f2a26;
      --btn-primary-gradient: linear-gradient(140deg, #3f7a5c 0%, #305b45 100%);
      --btn-primary-shadow: 0 20px 40px rgba(48, 91, 69, 0.22);
      --btn-alt-bg: rgba(255, 253, 247, 0.85);
      --btn-alt-border: rgba(217, 204, 186, 0.9);
      --btn-alt-hover-bg: rgba(240, 232, 216, 0.95);
    }

    body.dark-mode {
      --bg: #121021;
      --body-bg: radial-gradient(circle at 12% 10%, #2f2550 0%, #18132b 45%, #090712 100%);
      --panel: rgba(25, 21, 40, 0.94);
      --panel-soft: rgba(33, 27, 54, 0.9);
      --text: #f6f5ff;
      --muted: #b8b2d2;
      --accent: #ffb87d;
      --accent-dark: #ff9f68;
      --border: rgba(106, 87, 148, 0.45);
      --shadow: 0 24px 55px rgba(10, 6, 24, 0.6);
      --shadow-soft: 0 18px 44px rgba(10, 6, 24, 0.5);
      --header-bg: rgba(19, 16, 34, 0.85);
      --nav-link: rgba(223, 220, 255, 0.78);
      --nav-link-hover-bg: rgba(255, 184, 125, 0.15);
      --nav-link-active-bg: rgba(255, 184, 125, 0.24);
      --badge-bg: rgba(63, 54, 92, 0.65);
      --badge-error-bg: rgba(120, 48, 70, 0.55);
      --badge-text: #ffb87d;
      --badge-error-text: #ff7c6f;
      --code-bg: rgba(36, 30, 56, 0.92);
      --code-text: #f6f5ff;
      --btn-primary-gradient: linear-gradient(135deg, #ffbb7f 0%, #ff7b54 45%, #ff5b69 100%);
      --btn-primary-shadow: 0 20px 45px rgba(255, 123, 84, 0.28);
      --btn-alt-bg: rgba(40, 32, 62, 0.65);
      --btn-alt-border: rgba(255, 255, 255, 0.18);
      --btn-alt-hover-bg: rgba(63, 54, 92, 0.75);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--body-bg);
      color: var(--text);
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      transition: background 0.4s ease, color 0.4s ease;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'DM Serif Display', serif;
      letter-spacing: -0.01em;
      color: var(--accent-dark);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .site-header {
      background: var(--header-bg);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 18px 42px rgba(56, 50, 45, 0.12);
      backdrop-filter: blur(12px);
      margin-bottom: 32px;
      transition: background 0.35s ease, border 0.35s ease, box-shadow 0.35s ease;
    }

    body.dark-mode .site-header {
      box-shadow: 0 22px 48px rgba(10, 6, 24, 0.6);
    }

    .nav-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 28px;
      flex: 1 1 auto;
      min-width: 0;
    }

    .brand {
      font-family: 'DM Serif Display', serif;
      font-size: 1.5rem;
      color: var(--accent-dark);
      letter-spacing: -0.02em;
      transition: color 0.3s ease;
    }

    .brand:hover {
      color: var(--accent);
    }

    .top-nav {
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
    }

    .top-nav a {
      color: var(--nav-link);
      font-weight: 600;
      padding: 10px 18px;
      border-radius: 999px;
      transition: all 0.25s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    .top-nav a:hover {
      color: var(--accent-dark);
      background: var(--nav-link-hover-bg);
      transform: translateY(-1px);
    }

    .top-nav a.is-active {
      color: var(--accent-dark);
      background: var(--nav-link-active-bg);
    }

    .top-nav a .nav-icon {
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: currentColor;
    }

    .top-nav a .nav-icon svg {
      width: 100%;
      height: 100%;
    }

    .top-nav a .nav-label {
      display: inline-block;
    }

    .account-pill {
      --pill-width: 220px;
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 6px 8px 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(160, 150, 136, 0.4);
      background: rgba(255, 253, 247, 0.94);
      box-shadow: 0 18px 36px rgba(56, 50, 45, 0.12);
      width: min(100%, var(--pill-width));
      overflow: hidden;
      transition: none;
    }

    .account-pill[data-ready='true'] {
      transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
    }

    .account-pill:hover {
      box-shadow: 0 22px 44px rgba(56, 50, 45, 0.16);
    }

    .account-pill[data-state="signed-in"] {
      --pill-width: 320px;
      padding-right: 18px;
    }

    .account-pill[data-state="signed-in"][data-identity-expanded="true"] {
      --pill-width: 460px;
    }

    .account-pill__identity {
      flex: 1 1 auto;
      overflow: hidden;
      max-width: 0;
      transition: none;
    }

    .account-pill[data-ready='true'] .account-pill__identity {
      transition: max-width 0.4s ease;
    }

    .account-pill[data-state="signed-in"] .account-pill__identity {
      max-width: 100%;
    }

    .account-pill__identity-inner {
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 0;
      opacity: 0;
      transform: translateX(-12px);
      transition: none;
    }

    .account-pill[data-ready='true'] .account-pill__identity-inner {
      transition: opacity 0.3s ease 0.05s, transform 0.3s ease 0.05s, gap 0.2s ease;
    }

    .account-pill[data-state="signed-in"] .account-pill__identity-inner {
      opacity: 1;
      transform: translateX(0);
    }

    .account-pill[data-state="signed-in"]:not([data-identity-expanded="true"]) .account-pill__identity-inner {
      gap: 0;
    }

    .account-pill__avatar {
      flex: 0 0 auto;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgba(63, 122, 92, 0.12), rgba(63, 122, 92, 0.24));
      color: var(--accent-dark);
      font-weight: 700;
      letter-spacing: 0.04em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
    }

    .account-pill__avatar:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .account-pill__details {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow: hidden;
      max-width: 0;
      opacity: 0;
      transform: translateX(-8px);
      transition: opacity 0.2s ease, max-width 0.25s ease, transform 0.25s ease;
    }

    .account-pill[data-identity-expanded="true"] .account-pill__details {
      max-width: 220px;
      opacity: 1;
      transform: translateX(0);
    }

    .account-pill__name {
      font-size: 0.95rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .account-pill__email {
      font-size: 0.78rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .account-pill__actions {
      display: none;
      align-items: center;
      gap: 10px;
      margin-left: 6px;
      flex: 0 0 auto;
    }

    .account-pill[data-state="signed-in"] .account-pill__actions {
      display: inline-flex;
    }

    .account-pill__account,
    .account-pill__signout,
    .account-pill__signin {
      font-family: inherit;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
    }

    .account-pill__account {
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(63, 122, 92, 0.12);
      color: var(--accent-dark);
      text-decoration: none;
      box-shadow: inset 0 0 0 1px rgba(63, 122, 92, 0.22);
    }

    .account-pill__account:hover {
      background: rgba(63, 122, 92, 0.18);
    }

    .account-pill__account:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.4);
      outline-offset: 2px;
    }

    .account-pill__signout {
      background: transparent;
      color: var(--accent);
      padding: 6px 0;
    }

    .account-pill__signout:hover {
      color: var(--accent-dark);
    }

    .account-pill__signout:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.35);
      outline-offset: 2px;
    }

    .account-pill__signin {
      margin-left: auto;
      padding: 10px 20px;
      border-radius: 999px;
      background: var(--btn-primary-gradient);
      color: #fffdf7;
      box-shadow: var(--btn-primary-shadow);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .account-pill__signin:hover {
      transform: translateY(-1px);
    }

    .account-pill__signin:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.45);
      outline-offset: 2px;
    }

    .account-pill[data-state="signed-in"] .account-pill__signin {
      display: none;
    }

    .account-pill__theme {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      width: 60px;
      height: 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffe8bb 0%, #ff9f68 45%, #7051ff 100%);
      border: none;
      cursor: pointer;
      box-shadow: 0 16px 30px rgba(85, 62, 149, 0.32);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      flex-shrink: 0;
    }

    .account-pill__theme:focus-visible {
      outline: 2px solid rgba(255, 255, 255, 0.65);
      outline-offset: 3px;
    }

    .account-pill__theme:hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 42px rgba(85, 62, 149, 0.42);
    }

    .theme-toggle__thumb {
      position: absolute;
      inset: 4px auto 4px 4px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff6d6 0%, #ffd18a 60%, #ff9f68 100%);
      box-shadow: 0 8px 18px rgba(255, 159, 104, 0.45);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.dark-mode .account-pill {
      background: rgba(24, 19, 43, 0.9);
      border-color: rgba(255, 255, 255, 0.08);
      box-shadow: 0 26px 55px rgba(5, 2, 18, 0.65);
    }

    body.dark-mode .account-pill__avatar {
      background: linear-gradient(145deg, rgba(255, 184, 125, 0.18), rgba(255, 91, 105, 0.2));
      color: #ffe3c9;
    }

    body.dark-mode .account-pill__email {
      color: rgba(246, 245, 255, 0.7);
    }

    body.dark-mode .account-pill__account {
      background: rgba(255, 184, 125, 0.18);
      color: #ffe3c9;
      box-shadow: inset 0 0 0 1px rgba(255, 184, 125, 0.32);
    }

    body.dark-mode .account-pill__account:hover {
      background: rgba(255, 184, 125, 0.26);
    }

    body.dark-mode .account-pill__signout {
      color: #ffb87d;
    }

    body.dark-mode .account-pill__signout:hover {
      color: #ffd2aa;
    }

    body.dark-mode .account-pill__theme {
      background: linear-gradient(135deg, #342c62 0%, #7051ff 45%, #ff9f68 100%);
      box-shadow: 0 22px 45px rgba(48, 35, 92, 0.55);
    }

    body.dark-mode .theme-toggle__thumb {
      transform: translateX(30px);
      background: radial-gradient(circle at 30% 30%, #cfe7ff 0%, #84c2ff 55%, #3a8dff 100%);
      box-shadow: 0 12px 24px rgba(58, 141, 255, 0.4);
    }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .page-title {
      margin: 0;
      font-size: clamp(2rem, 4vw, 2.8rem);
      color: var(--accent-dark);
      letter-spacing: -0.02em;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px 26px;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-soft);
    }

    #logContainer {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card h2 {
      margin: 0 0 14px;
      font-size: 1.35rem;
      color: var(--accent-dark);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      background: var(--btn-primary-gradient);
      color: #f6f3eb;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
      box-shadow: 0 16px 30px rgba(48, 91, 69, 0.18);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--btn-primary-shadow);
    }

    .btn.alt {
      background: var(--btn-alt-bg);
      color: var(--accent-dark);
      border: 2px solid var(--btn-alt-border);
      box-shadow: none;
    }

    .btn.alt:hover {
      background: var(--btn-alt-hover-bg);
      box-shadow: none;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #statusHint {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .empty {
      color: var(--muted);
      font-style: italic;
    }

    .entry {
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px 22px;
      background: var(--panel-soft);
      display: flex;
      flex-direction: column;
      gap: 14px;
      transition: background 0.3s ease, border 0.3s ease, transform 0.3s ease;
    }

    .entry:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-soft);
    }

    .entry-header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      background: var(--badge-bg);
      color: var(--badge-text);
      border-radius: 999px;
      padding: 4px 14px;
      font-weight: 700;
      font-size: 0.75rem;
      letter-spacing: 0.02em;
    }

    .badge.error {
      background: var(--badge-error-bg);
      color: var(--badge-error-text);
    }

    time {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--accent-dark);
    }

    details[open] summary {
      margin-bottom: 8px;
    }

    pre {
      background: var(--code-bg);
      color: var(--code-text);
      border-radius: 16px;
      padding: 16px;
      overflow: auto;
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      transition: background 0.3s ease, color 0.3s ease;
    }

    @media (max-width: 640px) {
      main {
        padding: 20px 18px 72px;
      }

      .nav-inner {
        flex-wrap: nowrap;
        gap: 18px;
      }

      .nav-left {
        gap: 16px;
      }

      .brand {
        font-size: 1.35rem;
      }

      .top-nav {
        gap: 12px;
      }

      .top-nav a {
        padding: 10px;
        border-radius: 14px;
      }

      .top-nav a .nav-icon {
        width: 18px;
        height: 18px;
      }

      .top-nav a .nav-label {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .page-title {
        text-align: center;
      }

      .theme-toggle {
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav-inner">
      <div class="nav-left">
        <a class="brand" href="/index.html">Weekplan.ai</a>
        <nav class="top-nav" aria-label="Hovedmeny">
          <a href="/index.html" aria-label="Home">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 10.5 12 3l9 7.5" />
                <path d="M5.5 11.5v8a1 1 0 0 0 1 1H9v-5h6v5h2.5a1 1 0 0 0 1-1v-8" />
              </svg>
            </span>
            <span class="nav-label">Home</span>
          </a>
          <a href="/weekplan.html" aria-label="Weekplan">
            <span class="nav-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="5" width="18" height="16" rx="2" />
                <path d="M8 3v4" />
                <path d="M16 3v4" />
                <path d="M3 11h18" />
                <path d="m9.5 15 2 2 3-3" />
              </svg>
            </span>
            <span class="nav-label">Weekplan</span>
          </a>
        </nav>
      </div>
      <div class="account-pill" data-account-widget data-state="signed-out" data-identity-expanded="false" role="group" aria-label="Account controls" aria-expanded="false">
        <button id="theme-toggle" class="account-pill__theme" type="button" aria-pressed="false" aria-label="Aktiver mørk modus">
          <span class="theme-toggle__thumb" aria-hidden="true"></span>
        </button>
        <div class="account-pill__identity" aria-hidden="true">
          <div class="account-pill__identity-inner">
            <button class="account-pill__avatar" data-account-avatar type="button" aria-expanded="false" aria-label="Account avatar">WP</button>
            <div class="account-pill__details" data-account-details hidden aria-hidden="true">
              <span class="account-pill__name" data-account-name>Guest</span>
              <span class="account-pill__email" data-account-email></span>
            </div>
            <div class="account-pill__actions">
              <a class="account-pill__account" data-action="account" href="/account-admin.html">Account</a>
              <button class="account-pill__signout" data-action="sign-out" type="button">Sign out</button>
            </div>
          </div>
        </div>
        <button class="account-pill__signin" data-action="sign-in" type="button">Sign in</button>
      </div>
    </div>
  </header>
  <main>
    <h1 class="page-title">API-logg</h1>
    <section class="card">
      <h2>Siste kjøringer</h2>
      <div class="controls">
        <button id="refreshBtn" class="btn" type="button">Oppdater</button>
        <button id="clearBtn" class="btn alt" type="button">Tøm logg</button>
        <span id="statusHint"></span>
      </div>
    </section>
    <section id="logContainer" class="card" aria-live="polite"></section>
  </main>
  <script>
    const apiBody = document.body;
    const apiThemeToggle = document.getElementById('theme-toggle');
    const apiThemeKey = 'weekplan-theme';

    const apiStoredTheme = localStorage.getItem(apiThemeKey);
    const apiPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    let apiActiveTheme = apiStoredTheme || (apiPrefersDark ? 'dark' : 'light');

    const applyApiTheme = (theme, { persist = true } = {}) => {
      const isDark = theme === 'dark';
      apiBody.classList.toggle('dark-mode', isDark);
      apiThemeToggle?.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      apiThemeToggle?.setAttribute('aria-label', isDark ? 'Deaktiver mørk modus' : 'Aktiver mørk modus');
      apiActiveTheme = theme;
      if (persist) {
        localStorage.setItem(apiThemeKey, theme);
      } else {
        localStorage.removeItem(apiThemeKey);
      }
    };

    applyApiTheme(apiActiveTheme, { persist: Boolean(apiStoredTheme) });

    apiThemeToggle?.addEventListener('click', () => {
      applyApiTheme(apiActiveTheme === 'dark' ? 'light' : 'dark');
    });

    const apiPrefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    apiPrefersDarkScheme.addEventListener('change', (event) => {
      if (!localStorage.getItem(apiThemeKey)) {
        applyApiTheme(event.matches ? 'dark' : 'light', { persist: false });
      }
    });

  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.min.js" defer></script>
  <script src="/assets/scripts/account-widget.js" defer></script>
  <script type="module">
    import { ApiRunLogger } from './tools/apiEngine.js';

    const logger = new ApiRunLogger('api-run-log');
    const logContainer = document.getElementById('logContainer');
    const statusHint = document.getElementById('statusHint');
    const refreshBtn = document.getElementById('refreshBtn');
    const clearBtn = document.getElementById('clearBtn');

    function setStatus(message, timeout = 2000) {
      if (!statusHint) return;
      statusHint.textContent = message;
      if (timeout) {
        setTimeout(() => {
          statusHint.textContent = '';
        }, timeout);
      }
    }

    function renderLogs() {
      const entries = logger.load();
      if (!entries.length) {
        logContainer.innerHTML = '<div class="empty">Ingen kjøringer logget ennå. Generer en ukeplan for å se historikk.</div>';
        return;
      }
      logContainer.innerHTML = entries.map(entry => {
        const statusBadge = entry.status === 'error' ? '<span class="badge error">Feil</span>' : '<span class="badge">OK</span>';
        const provider = entry.provider ? `${entry.provider}` : 'ukjent';
        const model = entry.model ? ` – ${entry.model}` : '';
        const errorBlock = entry.error ? `<details open><summary>Feilmelding</summary><pre>${entry.error}</pre></details>` : '';
        const safePrompt = entry.prompt ? entry.prompt.replace(/</g,'&lt;') : '(ingen prompt)';
        const safeOutput = entry.output ? entry.output.replace(/</g,'&lt;') : '(ingen output)';
        return `
          <article class="entry">
            <div class="entry-header">
              <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
                ${statusBadge}
                <strong>${entry.label || entry.stepId || 'Ukjent steg'}</strong>
              </div>
              <time datetime="${entry.timestamp}">${new Date(entry.timestamp).toLocaleString()}</time>
            </div>
            <div class="meta">
              <span>Sekvens: ${entry.sequenceId}</span>
              <span>Provider: ${provider}${model}</span>
            </div>
            <details>
              <summary>Prompt</summary>
              <pre>${safePrompt}</pre>
            </details>
            <details>
              <summary>Output</summary>
              <pre>${safeOutput}</pre>
            </details>
            ${errorBlock}
          </article>
        `;
      }).join('');
    }

    refreshBtn.addEventListener('click', () => {
      renderLogs();
      setStatus('Oppdatert');
    });

    clearBtn.addEventListener('click', () => {
      if (!confirm('Vil du slette hele loggen?')) return;
      logger.clear();
      renderLogs();
      setStatus('Logg slettet');
    });

    renderLogs();
  </script>
</body>
</html>
