<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API Manager â€” Single Page</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display:wght@400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/styles/auth-modal.css" />
  <style>
    :root {
      --bg: #f3efe4;
      --body-bg: radial-gradient(circle at top, rgba(255, 255, 252, 0.95) 0%, var(--bg) 55%, #efe6d7 100%);
      --panel: #fffdf7;
      --panel-strong: #ffffff;
      --text: #2f2a26;
      --text-strong: #1f2933;
      --muted: #6d665c;
      --accent: #3f7a5c;
      --accent-dark: #305b45;
      --border: #e1d8c8;
      --shadow: 0 18px 42px rgba(56, 50, 45, 0.12);
      --shadow-soft: 0 12px 30px rgba(56, 50, 45, 0.08);
      --header-bg: rgba(255, 252, 246, 0.92);
      --nav-link: #6d665c;
      --nav-link-hover-bg: rgba(63, 122, 92, 0.12);
      --nav-link-active-bg: rgba(63, 122, 92, 0.18);
      --input-bg: #ffffff;
      --input-border: rgba(225, 216, 200, 0.9);
      --ring: rgba(63, 122, 92, 0.25);
      --chip-bg: rgba(255, 253, 247, 0.9);
      --chip-border: rgba(217, 204, 186, 0.65);
      --chip-active-bg: linear-gradient(140deg, #3f7a5c 0%, #305b45 100%);
      --chip-active-text: #f6f3eb;
      --status-ok: #4c8c6a;
      --status-err: #c96155;
      --btn-primary-gradient: linear-gradient(140deg, #3f7a5c 0%, #305b45 100%);
      --btn-primary-shadow: 0 20px 40px rgba(48, 91, 69, 0.22);
      --btn-alt-bg: rgba(255, 253, 247, 0.85);
      --btn-alt-border: rgba(217, 204, 186, 0.9);
      --btn-alt-hover-bg: rgba(240, 232, 216, 0.95);
    }

    body.dark-mode {
      --bg: #121021;
      --body-bg: radial-gradient(circle at 12% 10%, #2f2550 0%, #18132b 45%, #090712 100%);
      --panel: rgba(25, 21, 40, 0.94);
      --panel-strong: #211a38;
      --text: #f6f5ff;
      --text-strong: #ffffff;
      --muted: #b8b2d2;
      --accent: #ffb87d;
      --accent-dark: #ff9f68;
      --border: rgba(106, 87, 148, 0.45);
      --shadow: 0 24px 55px rgba(10, 6, 24, 0.6);
      --shadow-soft: 0 18px 44px rgba(10, 6, 24, 0.5);
      --header-bg: rgba(19, 16, 34, 0.85);
      --nav-link: rgba(223, 220, 255, 0.78);
      --nav-link-hover-bg: rgba(255, 184, 125, 0.15);
      --nav-link-active-bg: rgba(255, 184, 125, 0.24);
      --input-bg: rgba(36, 30, 56, 0.92);
      --input-border: rgba(114, 98, 162, 0.65);
      --ring: rgba(255, 184, 125, 0.4);
      --chip-bg: rgba(70, 54, 114, 0.4);
      --chip-border: rgba(147, 127, 210, 0.6);
      --chip-active-bg: linear-gradient(140deg, #ffb87d 0%, #ff7a9f 100%);
      --chip-active-text: rgba(20, 15, 40, 0.92);
      --status-ok: #58c59a;
      --status-err: #ff7c6f;
      --btn-primary-gradient: linear-gradient(135deg, #ffbb7f 0%, #ff7b54 45%, #ff5b69 100%);
      --btn-primary-shadow: 0 20px 45px rgba(255, 123, 84, 0.28);
      --btn-alt-bg: rgba(40, 32, 62, 0.65);
      --btn-alt-border: rgba(255, 255, 255, 0.18);
      --btn-alt-hover-bg: rgba(63, 54, 92, 0.75);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100%;
      background: var(--body-bg);
      color: var(--text);
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      transition: background 0.4s ease, color 0.4s ease;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'DM Serif Display', serif;
      letter-spacing: -0.01em;
      color: var(--accent-dark);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .site-header {
      background: var(--header-bg);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 18px 42px rgba(56, 50, 45, 0.12);
      backdrop-filter: blur(12px);
      margin-bottom: 32px;
      transition: background 0.35s ease, border 0.35s ease, box-shadow 0.35s ease;
    }

    body.dark-mode .site-header {
      box-shadow: 0 22px 48px rgba(10, 6, 24, 0.6);
    }

    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 28px;
      flex: 1 1 auto;
      min-width: 0;
    }

    .brand {
      font-family: 'DM Serif Display', serif;
      font-size: 1.5rem;
      color: var(--accent-dark);
      letter-spacing: -0.02em;
      transition: color 0.3s ease;
    }

    .brand:hover {
      color: var(--accent);
    }

    .top-nav {
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
    }

    .top-nav a {
      color: var(--nav-link);
      text-decoration: none;
      font-weight: 600;
      padding: 10px 18px;
      border-radius: 999px;
      transition: all 0.25s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    .top-nav a:hover {
      color: var(--accent-dark);
      background: var(--nav-link-hover-bg);
      transform: translateY(-1px);
    }

    .top-nav a.is-active {
      color: var(--accent-dark);
      background: var(--nav-link-active-bg);
    }

    .top-nav a .nav-icon {
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: currentColor;
    }

    .top-nav a .nav-icon svg {
      width: 100%;
      height: 100%;
    }

    .top-nav a .nav-label {
      display: inline-block;
    }

    .account-pill {
      --pill-width: 220px;
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 6px 8px 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(160, 150, 136, 0.4);
      background: rgba(255, 253, 247, 0.94);
      box-shadow: 0 18px 36px rgba(56, 50, 45, 0.12);
      width: min(100%, var(--pill-width));
      overflow: hidden;
      transition: none;
    }

    .account-pill[data-ready='true'] {
      transition: width 0.45s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
    }

    .account-pill:hover {
      box-shadow: 0 22px 44px rgba(56, 50, 45, 0.16);
    }

    .account-pill[data-state="signed-in"] {
      --pill-width: 320px;
      padding-right: 18px;
    }

    .account-pill[data-state="signed-in"][data-identity-expanded="true"] {
      --pill-width: 460px;
    }

    .account-pill__identity {
      flex: 1 1 auto;
      overflow: hidden;
      max-width: 0;
      transition: none;
    }

    .account-pill[data-ready='true'] .account-pill__identity {
      transition: max-width 0.4s ease;
    }

    .account-pill[data-state="signed-in"] .account-pill__identity {
      max-width: 100%;
    }

    .account-pill__identity-inner {
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 0;
      opacity: 0;
      transform: translateX(-12px);
      transition: none;
    }

    .account-pill[data-ready='true'] .account-pill__identity-inner {
      transition: opacity 0.3s ease 0.05s, transform 0.3s ease 0.05s, gap 0.2s ease;
    }

    .account-pill[data-state="signed-in"] .account-pill__identity-inner {
      opacity: 1;
      transform: translateX(0);
    }

    .account-pill[data-state="signed-in"]:not([data-identity-expanded="true"]) .account-pill__identity-inner {
      gap: 0;
    }

    .account-pill__avatar {
      flex: 0 0 auto;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgba(63, 122, 92, 0.12), rgba(63, 122, 92, 0.24));
      color: var(--accent-dark);
      font-weight: 700;
      letter-spacing: 0.04em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
    }

    .account-pill__avatar:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .account-pill__details {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow: hidden;
      max-width: 0;
      opacity: 0;
      transform: translateX(-8px);
      transition: opacity 0.2s ease, max-width 0.25s ease, transform 0.25s ease;
    }

    .account-pill[data-identity-expanded="true"] .account-pill__details {
      max-width: 220px;
      opacity: 1;
      transform: translateX(0);
    }

    .account-pill__name {
      font-size: 0.95rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .account-pill__email {
      font-size: 0.78rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .account-pill__actions {
      display: none;
      align-items: center;
      gap: 10px;
      margin-left: 6px;
      flex: 0 0 auto;
    }

    .account-pill[data-state="signed-in"] .account-pill__actions {
      display: inline-flex;
    }

    .account-pill__account,
    .account-pill__signout,
    .account-pill__signin {
      font-family: inherit;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
    }

    .account-pill__account {
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(63, 122, 92, 0.12);
      color: var(--accent-dark);
      text-decoration: none;
      box-shadow: inset 0 0 0 1px rgba(63, 122, 92, 0.22);
    }

    .account-pill__account:hover {
      background: rgba(63, 122, 92, 0.18);
    }

    .account-pill__account:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.4);
      outline-offset: 2px;
    }

    .account-pill__signout {
      background: transparent;
      color: var(--accent);
      padding: 6px 0;
    }

    .account-pill__signout:hover {
      color: var(--accent-dark);
    }

    .account-pill__signout:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.35);
      outline-offset: 2px;
    }

    .account-pill__signin {
      margin-left: auto;
      padding: 10px 20px;
      border-radius: 999px;
      background: var(--btn-primary-gradient);
      color: #fffdf7;
      box-shadow: var(--btn-primary-shadow);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .account-pill__signin:hover {
      transform: translateY(-1px);
    }

    .account-pill__signin:focus-visible {
      outline: 2px solid rgba(63, 122, 92, 0.45);
      outline-offset: 2px;
    }

    .account-pill[data-state="signed-in"] .account-pill__signin {
      display: none;
    }

    .account-pill__theme {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      width: 60px;
      height: 30px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ffe8bb 0%, #ff9f68 45%, #7051ff 100%);
      border: none;
      cursor: pointer;
      box-shadow: 0 16px 30px rgba(85, 62, 149, 0.32);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      flex-shrink: 0;
    }

    .account-pill__theme:focus-visible {
      outline: 2px solid rgba(255, 255, 255, 0.65);
      outline-offset: 3px;
    }

    .account-pill__theme:hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 42px rgba(85, 62, 149, 0.42);
    }

    .theme-toggle__thumb {
      position: absolute;
      inset: 4px auto 4px 4px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff6d6 0%, #ffd18a 60%, #ff9f68 100%);
      box-shadow: 0 8px 18px rgba(255, 159, 104, 0.45);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.dark-mode .account-pill {
      background: rgba(24, 19, 43, 0.9);
      border-color: rgba(255, 255, 255, 0.08);
      box-shadow: 0 26px 55px rgba(5, 2, 18, 0.65);
    }

    body.dark-mode .account-pill__avatar {
      background: linear-gradient(145deg, rgba(255, 184, 125, 0.18), rgba(255, 91, 105, 0.2));
      color: #ffe3c9;
    }

    body.dark-mode .account-pill__email {
      color: rgba(246, 245, 255, 0.7);
    }

    body.dark-mode .account-pill__account {
      background: rgba(255, 184, 125, 0.18);
      color: #ffe3c9;
      box-shadow: inset 0 0 0 1px rgba(255, 184, 125, 0.32);
    }

    body.dark-mode .account-pill__account:hover {
      background: rgba(255, 184, 125, 0.26);
    }

    body.dark-mode .account-pill__signout {
      color: #ffb87d;
    }

    body.dark-mode .account-pill__signout:hover {
      color: #ffd2aa;
    }

    body.dark-mode .account-pill__theme {
      background: linear-gradient(135deg, #342c62 0%, #7051ff 45%, #ff9f68 100%);
      box-shadow: 0 22px 45px rgba(48, 35, 92, 0.55);
    }

    body.dark-mode .theme-toggle__thumb {
      transform: translateX(30px);
      background: radial-gradient(circle at 30% 30%, #cfe7ff 0%, #84c2ff 55%, #3a8dff 100%);
      box-shadow: 0 12px 24px rgba(58, 141, 255, 0.4);
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .page-title {
      font-size: clamp(2rem, 4vw, 2.8rem);
      margin: 0;
      color: var(--accent-dark);
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: -0.02em;
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 26px 28px;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-soft);
    }

    .head {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .head .title {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-strong);
    }

    .muted {
      color: var(--muted);
      font-size: 0.95rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 150px 1fr 170px;
      gap: 14px;
      align-items: end;
      margin-bottom: 12px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--muted);
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 0.95rem;
      font-family: inherit;
      transition: background 0.3s ease, color 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid var(--ring);
      outline-offset: 2px;
    }

    textarea {
      min-height: 140px;
      resize: vertical;
      font-family: ui-monospace, Monaco, 'Courier New', monospace;
      line-height: 1.5;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      background: var(--btn-primary-gradient);
      color: #f6f3eb;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
      box-shadow: 0 16px 30px rgba(48, 91, 69, 0.18);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--btn-primary-shadow);
    }

    .btn.primary {
      background: var(--btn-primary-gradient);
      color: #f6f3eb;
    }

    .btn.alt,
    .btn.ghost {
      background: var(--btn-alt-bg);
      color: var(--accent-dark);
      border: 2px solid var(--btn-alt-border);
      box-shadow: none;
    }

    .btn.alt:hover,
    .btn.ghost:hover {
      background: var(--btn-alt-hover-bg);
      box-shadow: none;
    }

    .btn.ghost {
      background: transparent;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--muted);
    }

    @keyframes pulse {
      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.3;
      }
    }

    .status.loading .dot {
      background: var(--accent);
      animation: pulse 1.5s infinite;
    }

    .status.ok {
      color: var(--status-ok);
    }

    .status.ok .dot {
      background: var(--status-ok);
    }

    .status.error {
      color: var(--status-err);
    }

    .status.error .dot {
      background: var(--status-err);
    }

    .chips {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0 6px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      cursor: pointer;
      font-size: 0.85rem;
      color: var(--text);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .chip:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-soft);
    }

    .chip button {
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.6;
      font-weight: 700;
      color: inherit;
    }

    .chip button:hover {
      opacity: 1;
    }

    .chip.active {
      background: var(--chip-active-bg);
      color: var(--chip-active-text);
      border-color: transparent;
      box-shadow: 0 16px 30px rgba(48, 91, 69, 0.18);
    }

    .chip.active button {
      color: inherit;
      opacity: 0.85;
    }

    .hidden {
      display: none !important;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 18px 0;
    }

    .output {
      background: var(--panel-strong);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      min-height: 220px;
      font-family: ui-monospace, Monaco, 'Courier New', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-wrap: break-word;
      color: var(--text);
      line-height: 1.55;
      transition: background 0.35s ease, color 0.35s ease, border 0.35s ease;
    }

    .output.empty {
      color: var(--muted);
      font-style: italic;
    }

    .output h1,
    .output h2,
    .output h3,
    .output h4,
    .output h5,
    .output h6 {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 700;
      line-height: 1.25;
      margin: 0.75em 0 0.4em;
    }

    @media (max-width: 820px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      main {
        padding: 20px 18px 72px;
      }

      .nav-inner {
        flex-wrap: nowrap;
        gap: 18px;
      }

      .nav-left {
        gap: 16px;
      }

      .brand {
        font-size: 1.35rem;
      }

      .top-nav {
        gap: 12px;
      }

      .top-nav a {
        padding: 10px;
        border-radius: 14px;
      }

      .top-nav a .nav-icon {
        width: 18px;
        height: 18px;
      }

      .top-nav a .nav-label {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .page-title {
        justify-content: center;
        text-align: center;
      }

      .account-pill {
        margin: 0 auto;
        --pill-width: 100%;
      }
    }
  </style>
</head>
<body>
<header class="site-header">
  <div class="nav-inner">
    <div class="nav-left">
      <a class="brand" href="/index.html">Weekplan.ai</a>
      <nav class="top-nav" aria-label="Hovedmeny">
        <a href="/index.html" aria-label="Home">
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 10.5 12 3l9 7.5" />
              <path d="M5.5 11.5v8a1 1 0 0 0 1 1H9v-5h6v5h2.5a1 1 0 0 0 1-1v-8" />
            </svg>
          </span>
          <span class="nav-label">Home</span>
        </a>
        <a href="/weekplan.html" aria-label="Weekplan">
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="5" width="18" height="16" rx="2" />
              <path d="M8 3v4" />
              <path d="M16 3v4" />
              <path d="M3 11h18" />
              <path d="m9.5 15 2 2 3-3" />
            </svg>
          </span>
          <span class="nav-label">Weekplan</span>
        </a>
      </nav>
    </div>
    <div class="account-pill" data-account-widget data-state="signed-out" data-identity-expanded="false" role="group" aria-label="Account controls" aria-expanded="false">
      <button id="theme-toggle" class="account-pill__theme" type="button" aria-pressed="false" aria-label="Aktiver mÃ¸rk modus">
        <span class="theme-toggle__thumb" aria-hidden="true"></span>
      </button>
      <div class="account-pill__identity" aria-hidden="true">
        <div class="account-pill__identity-inner">
          <button class="account-pill__avatar" data-account-avatar type="button" aria-expanded="false" aria-label="Account avatar">WP</button>
          <div class="account-pill__details" data-account-details hidden aria-hidden="true">
            <span class="account-pill__name" data-account-name>Guest</span>
            <span class="account-pill__email" data-account-email></span>
          </div>
          <div class="account-pill__actions">
            <a class="account-pill__account" data-action="account" href="/account-admin.html">Account</a>
            <button class="account-pill__signout" data-action="sign-out" type="button">Sign out</button>
          </div>
        </div>
      </div>
      <button class="account-pill__signin" data-action="sign-in" type="button">Sign in</button>
    </div>
  </div>
</header>

<main>
  <h1 class="page-title">ðŸ¤– API Manager</h1>
  <!-- API Setup -->
  <section id="config-card" class="card">
    <div class="head">
      <div class="title">API Configuration</div>
      <span class="muted">Set up API keys and models</span>
    </div>

    <!-- Favorites -->
    <div id="favorites-section" class="hidden">
      <div class="head" style="margin-top:0">
        <div class="title" style="font-size:16px">Favorites</div>
      </div>
      <div id="favorite-chips" class="chips"></div>
      <div class="divider"></div>
    </div>

    <!-- Provider & Key -->
    <div class="form-row">
      <div class="form-group">
        <label>Provider</label>
        <select id="provider">
          <option value="openrouter">OpenRouter</option>
          <option value="openai">OpenAI</option>
          <option value="gemini">Gemini</option>
          <option value="grok">Grok</option>
        </select>
      </div>
      <div class="form-group">
        <label>API Key</label>
        <input id="api-key" type="password" placeholder="Paste API key" />
      </div>
      <button class="btn" id="save-key">Save</button>
    </div>

    <!-- OpenRouter Controls -->
    <div class="form-row" id="openrouter-controls">
      <div class="form-group">
        <label>Model</label>
        <select id="model-select">
          <option value="nvidia/nemotron-nano-9b-v2:free">nvidia/nemotron-nano-9b-v2:free</option>
        </select>
      </div>
      <div class="form-group">
        <label style="color:transparent">.</label>
        <div style="display:flex; gap:8px">
          <button class="btn ghost" id="refresh-models">Refresh</button>
          <label style="display:flex; align-items:center; gap:6px; font-size:14px">
            <input type="checkbox" id="only-free" />
            FREE only
          </label>
        </div>
      </div>
      <div class="form-group">
        <label style="color:transparent">.</label>
        <button class="btn ghost" id="toggle-favorite-or" style="width:100%">â˜† Favorite</button>
      </div>
    </div>

    <!-- Generic Model Input -->
    <div class="form-row hidden" id="generic-controls">
      <div class="form-group">
        <label>Model</label>
        <input id="model-input" type="text" placeholder="e.g. gpt-4o-mini" />
      </div>
      <div></div>
      <div class="form-group">
        <label style="color:transparent">.</label>
        <button class="btn ghost" id="toggle-favorite-gen" style="width:100%">â˜† Favorite</button>
      </div>
    </div>

    <!-- Status -->
    <div class="status" id="api-status">
      <div class="dot"></div>
      <span>Ready</span>
    </div>
  </section>

  <!-- Playground -->
  <section id="playground-card" class="card">
    <div class="head">
      <div class="title">API Playground</div>
      <span class="muted">Test requests using the selected provider, key and model above</span>
    </div>

    <div class="form-group" style="margin-bottom:16px">
      <label>Input (prompt or JSON)</label>
      <textarea id="input-text" placeholder='Type your prompt or JSON here...

Example prompt:
"Write a very short story about a robot that learns to make coffee"

Example JSON:
{
  "instruction": "Translate to English",
  "text": "Hei verden"
}'></textarea>
    </div>

    <div style="display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap">
      <button class="btn" id="demo-btn">Load demo</button>
      <button class="btn primary" id="send-btn">Send to API</button>
      <button class="btn ghost" id="clear-btn">Clear</button>
      <button class="btn" id="format-toggle-btn" title="Toggle simple formatting">Formatting: On</button>
    </div>

    <div class="form-group">
      <label>Output</label>
      <div id="output" class="output empty">No output yet. Send a request to the API.</div>
    </div>

    <div class="status" id="playground-status">
      <div class="dot"></div>
      <span>Ready</span>
    </div>
  </section>
</main>

<script>
  const managerBody = document.body;
  const managerToggle = document.getElementById('theme-toggle');
  const managerThemeKey = 'weekplan-theme';

  const managerStoredTheme = localStorage.getItem(managerThemeKey);
  const managerPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  let managerActiveTheme = managerStoredTheme || (managerPrefersDark ? 'dark' : 'light');

  const applyManagerTheme = (theme, { persist = true } = {}) => {
    const isDark = theme === 'dark';
    managerBody.classList.toggle('dark-mode', isDark);
    managerToggle?.setAttribute('aria-pressed', isDark ? 'true' : 'false');
    managerToggle?.setAttribute('aria-label', isDark ? 'Deaktiver mÃ¸rk modus' : 'Aktiver mÃ¸rk modus');
    managerActiveTheme = theme;
    if (persist) {
      localStorage.setItem(managerThemeKey, theme);
    } else {
      localStorage.removeItem(managerThemeKey);
    }
  };

  applyManagerTheme(managerActiveTheme, { persist: Boolean(managerStoredTheme) });

  managerToggle?.addEventListener('click', () => {
    applyManagerTheme(managerActiveTheme === 'dark' ? 'light' : 'dark');
  });

  const managerPrefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
  managerPrefersDarkScheme.addEventListener('change', (event) => {
    if (!localStorage.getItem(managerThemeKey)) {
      applyManagerTheme(event.matches ? 'dark' : 'light', { persist: false });
    }
  });

</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.min.js" defer></script>
<script src="/assets/scripts/account-widget.js" defer></script>

<script type="module">
  import { DEMO_PROMPT } from './menuDemoPrompt.js';
  import { getCurrentProvider, setCurrentProvider } from './apiEngine.js';

  class GenericAPIManager {
    constructor() {
      this.providers = {
        openrouter: { keyStorage: 'api-key-openrouter', favsStorage: 'api-favs-openrouter' },
        openai:     { keyStorage: 'api-key-openai',     favsStorage: 'api-favs-openai'     },
        gemini:     { keyStorage: 'api-key-gemini',     favsStorage: 'api-favs-gemini'     },
        grok:       { keyStorage: 'api-key-grok',       favsStorage: 'api-favs-grok'       }
      };
      this.currentProvider = getCurrentProvider?.() || 'openrouter';
      this.init();
    }

    init() {
      this.bindEvents();
      this.loadCurrentSettings();
      this.renderFavorites();
    }

    bindEvents() {
      // Provider change
      document.getElementById('provider').addEventListener('change', (e) => {
        this.currentProvider = e.target.value;
        if (typeof setCurrentProvider === 'function') {
          setCurrentProvider(this.currentProvider);
        }
        this.loadCurrentSettings();
      });

      // Save key
      document.getElementById('save-key').addEventListener('click', () => {
        this.saveCurrentKey();
      });

      // OpenRouter: refresh models
      document.getElementById('refresh-models').addEventListener('click', () => {
        this.refreshModels();
      });

      // Only free filter
      document.getElementById('only-free').addEventListener('change', () => {
        this.refreshModels();
      });

      // Favorites
      document.getElementById('toggle-favorite-or').addEventListener('click', () => {
        this.toggleFavorite();
      });
      document.getElementById('toggle-favorite-gen').addEventListener('click', () => {
        this.toggleFavorite();
      });

      // OpenRouter model select changes (persist)
      document.getElementById('model-select').addEventListener('change', () => {
        const val = document.getElementById('model-select').value;
        try { localStorage.setItem('api-current-model-openrouter', val); } catch {}
        this.updateFavoriteButton();
        this.renderFavorites();
      });

      // Generic input type (persist per provider)
      document.getElementById('model-input').addEventListener('input', (e) => {
        const key = `api-current-model-${this.currentProvider}`;
        try { localStorage.setItem(key, e.target.value.trim()); } catch {}
        this.updateFavoriteButton();
        this.renderFavorites();
      });
    }

    setStatus(message, type = 'default') {
      const status = document.getElementById('api-status');
      const span = status.querySelector('span');
      span.textContent = message;
      status.className = 'status' + (type !== 'default' ? ` ${type}` : '');
    }

    loadCurrentSettings() {
      const provider = this.currentProvider;
      document.getElementById('provider').value = provider;

      // Key
      const savedKey = this.getStoredKey(provider);
      const keyEl = document.getElementById('api-key');
      keyEl.value = savedKey;
      keyEl.placeholder = this.getKeyPlaceholder(provider);
      document.getElementById('save-key').textContent = savedKey ? 'Saved' : 'Save';

      // Toggle control groups
      const isOpenRouter = provider === 'openrouter';
      document.getElementById('openrouter-controls').classList.toggle('hidden', !isOpenRouter);
      document.getElementById('generic-controls').classList.toggle('hidden', isOpenRouter);

      if (isOpenRouter) {
        // restore saved OR model if present
        const savedModel = localStorage.getItem('api-current-model-openrouter');
        if (savedModel) {
          const sel = document.getElementById('model-select');
          sel.value = savedModel; // if not in list yet, Refresh will set it properly
        }
      } else {
        // generic model input visible + restored per provider
        const input = document.getElementById('model-input');
        input.placeholder = this.getModelPlaceholder(provider);
        const savedModel = localStorage.getItem(`api-current-model-${provider}`) || '';
        input.value = savedModel;
      }

      this.updateFavoriteButton();
      this.renderFavorites();
    }

    getStoredKey(provider) {
      try { return localStorage.getItem(this.providers[provider].keyStorage) || ''; }
      catch { return ''; }
    }

    saveCurrentKey() {
      const key = document.getElementById('api-key').value.trim();
      const provider = this.currentProvider;
      try {
        if (key) {
          localStorage.setItem(this.providers[provider].keyStorage, key);
          this.setStatus('Key saved', 'ok');
        } else {
          localStorage.removeItem(this.providers[provider].keyStorage);
          this.setStatus('Key removed', 'ok');
        }
        document.getElementById('save-key').textContent = key ? 'Saved' : 'Save';
      } catch {
        this.setStatus('Could not save the key', 'error');
      }
    }

    getKeyPlaceholder(provider) {
      const p = {
        openrouter: 'Paste your OpenRouter API key',
        openai:     'Paste your OpenAI API key',
        gemini:     'Paste your Google AI API key',
        grok:       'Paste your Grok (xAI) API key'
      };
      return p[provider] || 'Paste API key';
    }

    getModelPlaceholder(provider) {
      const p = {
        openai: 'e.g. gpt-4o-mini',
        gemini: 'e.g. gemini-2.0-flash',
        grok:   'e.g. grok-2'
      };
      return p[provider] || 'Type a model name';
    }

    // === OpenRouter models ===
    async refreshModels() {
      if (this.currentProvider !== 'openrouter') return;

      const key = this.getStoredKey('openrouter');
      const onlyFree = document.getElementById('only-free').checked;
      const select = document.getElementById('model-select');

      this.setStatus('Fetching modelsâ€¦', 'loading');

      try {
        const headers = {
          'Accept': 'application/json'
        };
        if (key) headers['Authorization'] = `Bearer ${key}`;

        let url = 'https://openrouter.ai/api/v1/models';
        const models = [];

        // fetch all pages if paginated
        while (url) {
          const res = await fetch(url, { headers, mode: 'cors' });
          if (!res.ok) {
            const t = await res.text();
            throw new Error(`Failed to fetch models (${res.status}): ${t || 'Unknown error'}`);
          }
          const data = await res.json();
          (data?.data || []).forEach(m => { if (m?.id) models.push(m.id); });
          url = data?.meta?.next || data?.links?.next || null;
        }

        let filtered = models;
        if (onlyFree) filtered = filtered.filter(id => id.includes(':free'));

        filtered.sort((a,b)=>{
          const af=a.includes(':free'), bf=b.includes(':free');
          if (af && !bf) return -1;
          if (!af && bf) return 1;
          return a.localeCompare(b);
        });

        const prevSaved = localStorage.getItem('api-current-model-openrouter');
        const currentVal = select.value;

        select.innerHTML = '';
        filtered.forEach(id => {
          const opt = document.createElement('option');
          opt.value = id; opt.textContent = id;
          select.appendChild(opt);
        });

        if (prevSaved && filtered.includes(prevSaved)) {
          select.value = prevSaved;
        } else if (currentVal && filtered.includes(currentVal)) {
          select.value = currentVal;
        }

        if (select.value) {
          try { localStorage.setItem('api-current-model-openrouter', select.value); } catch {}
        }

        this.setStatus(`Found ${filtered.length} models`, 'ok');
        this.updateFavoriteButton();
      } catch (err) {
        console.error(err);
        this.setStatus(err.message || 'Error fetching models', 'error');
      }
    }

    getCurrentModel() {
      return this.currentProvider === 'openrouter'
        ? document.getElementById('model-select').value
        : document.getElementById('model-input').value.trim();
    }

    getFavorites() {
      try { return JSON.parse(localStorage.getItem(this.providers[this.currentProvider].favsStorage) || '[]'); }
      catch { return []; }
    }

    setFavorites(favs) {
      try { localStorage.setItem(this.providers[this.currentProvider].favsStorage, JSON.stringify(favs)); }
      catch {}
    }

    toggleFavorite() {
      const model = this.getCurrentModel();
      if (!model) return;
      const favs = this.getFavorites();
      const idx = favs.indexOf(model);
      if (idx === -1) { favs.push(model); this.setStatus('Added to favorites', 'ok'); }
      else { favs.splice(idx,1); this.setStatus('Removed from favorites', 'ok'); }
      this.setFavorites(favs);
      this.renderFavorites();
      this.updateFavoriteButton();
    }

    updateFavoriteButton() {
      const model = this.getCurrentModel();
      const isFav = model && this.getFavorites().includes(model);
      const orBtn = document.getElementById('toggle-favorite-or');
      const genBtn = document.getElementById('toggle-favorite-gen');

      if (this.currentProvider === 'openrouter') {
        orBtn.textContent = isFav ? 'â˜… Favorite' : 'â˜† Favorite';
        orBtn.disabled = !model;
      } else {
        genBtn.textContent = isFav ? 'â˜… Favorite' : 'â˜† Favorite';
        genBtn.disabled = !model;
      }

      const label = model ? `Selected model: ${model}${isFav ? ' â˜…' : ''}` : 'No model selected';
      this.setStatus(label, model ? 'ok' : 'default');
    }

    renderFavorites() {
      const favs = this.getFavorites();
      const container = document.getElementById('favorite-chips');
      const section = document.getElementById('favorites-section');
      if (favs.length === 0) { section.classList.add('hidden'); return; }
      section.classList.remove('hidden');
      container.innerHTML = '';

      const currentModel = this.getCurrentModel();

      favs.forEach(model => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        if (model === currentModel) chip.classList.add('active');
        chip.innerHTML = `<span>${model}</span><button type="button">Ã—</button>`;

        chip.addEventListener('click',(e)=>{
          if (e.target.tagName === 'BUTTON') return;
          if (this.currentProvider === 'openrouter') {
            const sel = document.getElementById('model-select');
            sel.value = model;
            try { localStorage.setItem('api-current-model-openrouter', model); } catch {}
            sel.dispatchEvent(new Event('change', { bubbles: true }));
          } else {
            const input = document.getElementById('model-input');
            input.value = model;
            try { localStorage.setItem(`api-current-model-${this.currentProvider}`, model); } catch {}
            this.updateFavoriteButton(); this.renderFavorites();
          }
        });

        chip.querySelector('button').addEventListener('click',(e)=>{
          e.stopPropagation();
          const nf = this.getFavorites().filter(f => f !== model);
          this.setFavorites(nf); this.renderFavorites(); this.updateFavoriteButton();
        });

        container.appendChild(chip);
      });
    }

    // === API calls ===
    async callAPI(prompt) {
      const provider = this.currentProvider;
      const key = this.getStoredKey(provider);
      const model = this.getCurrentModel();
      if (!key) throw new Error('No API key found for ' + provider);
      if (!model) throw new Error('No model selected');

      switch (provider) {
        case 'openrouter': return this.callOpenRouter(key, model, prompt);
        case 'openai':     return this.callOpenAI(key, model, prompt);
        case 'gemini:':    // typo guard (wonâ€™t be used)
        case 'gemini':     return this.callGemini(key, model, prompt);
        case 'grok':       throw new Error('Grok support coming soon');
        default:           throw new Error('Unknown provider: ' + provider);
      }
    }

    async callOpenRouter(apiKey, model, prompt) {
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`,
          'HTTP-Referer': window.location.origin,
          'X-Title': 'Generic API Manager'
        },
        body: JSON.stringify({
          model,
          messages: [
            { role: 'system', content: 'You are a helpful assistant that replies in English.' },
            { role: 'user', content: prompt }
          ]
        })
      });
      if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
      const data = await res.json();
      return data?.choices?.[0]?.message?.content || 'No content from API';
    }

    async callOpenAI(apiKey, model, prompt) {
      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
        body: JSON.stringify({
          model,
          messages: [
            { role: 'system', content: 'You are a helpful assistant that replies in English.' },
            { role: 'user', content: prompt }
          ]
        })
      });
      if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
      const data = await res.json();
      return data?.choices?.[0]?.message?.content || 'No content from API';
    }

    async callGemini(apiKey, model, prompt) {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(model)}:generateContent`;
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-goog-api-key': apiKey },
        body: JSON.stringify({ contents: [{ role: 'user', parts: [{ text: prompt }] }] })
      });
      if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
      const data = await res.json();
      const parts = data?.candidates?.[0]?.content?.parts || [];
      return parts.map(p => p.text || '').join('').trim() || 'No content from API';
    }
  }

  // Playground
  function initPlayground(apiManager) {
    const inputEl = document.getElementById('input-text');
    const outputEl = document.getElementById('output');
    const statusEl = document.getElementById('playground-status');
    const sendBtn = document.getElementById('send-btn');
    const demoBtn = document.getElementById('demo-btn');
    const clearBtn = document.getElementById('clear-btn');
    const formatToggleBtn = document.getElementById('format-toggle-btn');

    let isFormatted = true;
    let lastContent = '';

    function setPlaygroundStatus(message, type = 'default') {
      const span = statusEl.querySelector('span');
      span.textContent = message;
      statusEl.className = 'status' + (type !== 'default' ? ` ${type}` : '');
    }
    function updateFormatToggle() {
      formatToggleBtn.textContent = isFormatted ? 'Formatting: On' : 'Formatting: Off';
      formatToggleBtn.title = isFormatted ? 'Showing formatted text' : 'Showing raw text';
    }
    function escapeHtml(s) {
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
    function setOutput(content, isEmpty=false) {
      lastContent = content;
      if (isEmpty) { outputEl.textContent = content; outputEl.classList.add('empty'); return; }
      outputEl.classList.remove('empty');
      if (isFormatted) outputEl.innerHTML = formatOutput(content);
      else outputEl.textContent = content;
    }
    function formatOutput(text) {
      if (!text) return '';
      let formatted = escapeHtml(text)
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/(?<!\*)\*([^*\n]+?)\*(?!\*)/g, '<em>$1</em>')
        .replace(/`([^`\n]+?)`/g, '<code style="background:var(--nav-hover);padding:2px 4px;border-radius:3px;font-family:ui-monospace,Monaco,monospace;font-size:13px;color:var(--text)">$1</code>')
        .replace(/\n/g, '<br>');
      const lines = formatted.split('<br>');
      const out = [];
      let listType = null;
      const close = ()=>{ if (listType){ out.push(listType==='ul' ? '</ul>' : '</ol>'); listType=null; } };
      for (let i=0;i<lines.length;i++){
        const raw = lines[i], line = raw.trim();
        if (line.startsWith('#')){
          let h=0; while(h<line.length && line[h]==='#') h++;
          if (h>0 && h<=6 && line[h]===' '){
            let content = line.slice(h+1).trimEnd();
            while (content.endsWith('#')) content = content.slice(0,-1).trimEnd();
            close(); out.push(`<h${h} style="margin:0 0 8px 0">${content}</h${h}>`); continue;
          }
        }
        if (line==='---' || line==='***' || line==='___'){ close(); out.push('<hr style="border:none;border-top:1px solid var(--border);margin:12px 0">'); continue; }
        if (/^[-*â€¢]\s+/.test(line)){ if (listType!=='ul'){ close(); out.push('<ul>'); listType='ul'; }
          out.push(`<li>${line.replace(/^[-*â€¢]\s+/,'')}</li>`);
        } else if (/^\d+\.\s+/.test(line)){ if (listType!=='ol'){ close(); out.push('<ol>'); listType='ol'; }
          out.push(`<li>${line.replace(/^\d+\.\s+/,'')}</li>`);
        } else { close(); out.push(line ? line + '<br>' : '<br>'); }
      }
      close(); return out.join('');
    }

    sendBtn.addEventListener('click', async () => {
      const input = inputEl.value.trim();
      if (!input) { setPlaygroundStatus('Type a prompt first', 'error'); return; }
      sendBtn.disabled = true;
      setPlaygroundStatus('Sendingâ€¦', 'loading');
      setOutput('Waiting for responseâ€¦', false);
      try {
        const response = await apiManager.callAPI(input);
        setOutput(response, false);
        setPlaygroundStatus('Response received', 'ok');
      } catch (err) {
        setOutput(`Error: ${err.message}`, false);
        setPlaygroundStatus('API call failed', 'error');
      } finally {
        sendBtn.disabled = false;
      }
    });

    demoBtn.addEventListener('click', () => {
      inputEl.value = DEMO_PROMPT;
      setPlaygroundStatus('Demo prompt loaded', 'ok');
    });

    clearBtn.addEventListener('click', () => {
      inputEl.value = ''; lastContent = '';
      setOutput('No output yet. Send a request to the API.', true);
      setPlaygroundStatus('Cleared', 'ok');
    });

    formatToggleBtn.addEventListener('click', () => {
      isFormatted = !isFormatted; updateFormatToggle();
      if (lastContent) setOutput(lastContent, false);
      setPlaygroundStatus(isFormatted ? 'Showing formatted text' : 'Showing raw text', 'ok');
    });

    updateFormatToggle();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const apiManager = new GenericAPIManager();
    initPlayground(apiManager);
    if (apiManager.currentProvider === 'openrouter') {
      setTimeout(() => apiManager.refreshModels(), 350);
    }
  });
</script>
</body>
</html>
